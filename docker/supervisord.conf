[supervisord]
nodaemon=true

[program:php-fpm]
command=/usr/local/sbin/php-fpm --nodaemonize
autostart=true
autorestart=true
priority=10

; Este comando primero prueba la configuración de nginx y, si falla,
; imprime el error log y sale con código distinto de 0 (que quedará en los logs de Render).
; Si la prueba es exitosa, arranca nginx en foreground.
[program:nginx]
command=/bin/sh -c "nginx -t || (echo '--- NGINX CONFIG TEST FAILED - SHOWING ERROR LOG ---' && tail -n +1 /var/log/nginx/error.log && exit 1); /usr/sbin/nginx -g 'daemon off;'"
autostart=true
autorestart=false
priority=20
